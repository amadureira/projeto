
- name: Set proxy
  set_fact: 
   pip_extra_args: "--proxy {{proxy_addr}}"
  when: proxy_addr is defined

- name: Config proxy
  lineinfile: 
   path: "/etc/yum.conf"
   regex: "^proxy=.+$"
   line: "proxy=http://{{proxy_addr}}"
  when: proxy_addr is defined

- name: Install docker
  yum: 
   name: python2-pip
   state: installed

- name: Install docker
  yum: 
   name: docker
   state: installed
  register: docker_install

- name: Init docker service
  service: 
   name: "docker"
   state: started

- name: Set proxy
  set_fact: 
   pip_extra_args: "--proxy {{proxy_addr}}"
  when: proxy_addr is defined

- name: pip install 
  pip: 
   name: "{{item}}"
   extra_args: "{{pip_extra_args| default('')}}"
  with_items: 
   - docker
